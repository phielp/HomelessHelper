<!DOCTYPE html>
<html>
<head>
<h1>Hello Demander!</h1>
</head>
<body onload=getCookie( "userID")>
	<button type="button" id="createRequestButton" onclick=location.href="CreateRequest.html">Create
		new request</button>
	<br>
	<br>
	<button type="button" id="loginButton" onclick="showRequests()">Show
		all my existing requests</button>

	<p id="demo"></p>

	<script>
		function showRequests() {
			var wedIds = [];
			wedIds[1]=3;
			//wedIds[2]=4;
			wedIds[3]=7;
			document.write(wedIds.length);
			
			var obj, dbParam, xmlhttp, myObj, x, txt = "";
			obj = {
				"table" : "requests",
				"limit" : 20
			};
			dbParam = JSON.stringify(obj);
			xmlhttp = new XMLHttpRequest();
			xmlhttp.onreadystatechange = function() {
				if (this.readyState == 4 && this.status == 200) {
					myObj = JSON.parse(this.responseText);
					txt += "<table border='1'>"
					for (x in myObj) {
						txt += "<tr><td>"
								+ myObj[x].requestTitle
								+ "</td> <td>"
								+ myObj[x].id
								+ "</td><td> <img src='"+myObj[x].photo+"' style='width:100px;height:100px;' />"	
								+ "</td>"
								+ "<td><button type='button' onclick='goToRequestDesc(\""
								+ myObj[x].id+"\", \""
								+ myObj[x].description+"\" )'>Show description</td>"
								+ "<td><button type='button' onclick='deleteRequest(\""
								+ myObj[x].id
								+ "\")' >remove entry</button></td> </tr>";
					}
					txt += "</table>"
					document.getElementById("demo").innerHTML = txt;
				}

			};
			var str = "http://localhost:8080/demander";
			xmlhttp.open("GET", str);
			xmlhttp.send();
		}
		function goToRequestDesc(myId, description){
			document.write(description);
		};
		
		function deleteRequest(myId) {
			xmlhttp = new XMLHttpRequest();
			var str = "http://localhost:8080/demander/" + myId;
			xmlhttp.open("DELETE", str);
			xmlhttp.send();
			xmlhttp.onreadystatechange = function() {
				if (this.readyState == 4 && this.status == 200) {
					showRequests();
				}
			};
		}
		
		function getCookie(cname) {
		    var name = cname + "=";
		    var decodedCookie = decodeURIComponent(document.cookie);
		    var ca = decodedCookie.split(';');
		    for(var i = 0; i <ca.length; i++) {
		        var c = ca[i];
		        while (c.charAt(0) == ' ') {
		            c = c.substring(1);
		        }
		        if (c.indexOf(name) == 0) {
		            return c.substring(name.length, c.length);
		        }
		    }
		    return "";
		}
		
	</script>

</body>
</html>